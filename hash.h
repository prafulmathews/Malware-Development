#pragma once
#include<Windows.h>

#define INITIAL_SEED 4

#define HASHA(API) HashStringDjb2A((const char*) API)
#define HASHW(API) (HashStringDjb2W((const wchar_t*) API))

#define CTHASHA(API) constexpr auto API##Djb2A=HashStringDjb2A((const char*) #API)
#define CTHASHW(API) constexpr auto API##Djb2W=HashStringDjb2W((const wchar_t*) L#API)

constexpr int RandomCompileTimeSeed(void)
{
	return '0' * -40271 +
		__TIME__[7] * 1 +
		__TIME__[6] * 10 +
		__TIME__[4] * 60 +
		__TIME__[3] * 600 +
		__TIME__[1] * 3600 +
		__TIME__[0] * 36000;
};

constexpr auto gkey = RandomCompileTimeSeed();

constexpr DWORD HashStringDjb2W(const wchar_t* String) {
	ULONG Hash = (ULONG)gkey;
	INT c = 0;
	while ((c = *String++)) {
		Hash = ((Hash << INITIAL_SEED) + Hash) + c;
	}

	return Hash;
}

// Compile time Djb2 hashing function (ASCII)
constexpr DWORD HashStringDjb2A(const char* String) {
	ULONG Hash = (ULONG)gkey;
	INT c = 0;
	while ((c = *String++)) {
		Hash = ((Hash << INITIAL_SEED) + Hash) + c;
	}

	return Hash;
}