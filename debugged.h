#pragma once

#include<Windows.h>
#include<winternl.h>
#include "getpid.h"

#define BLACKLISTARRAY_SIZE 5 // Number of elements inside the array

const WCHAR* g_BlackListedDebuggers[BLACKLISTARRAY_SIZE] = {
		L"x64dbg.exe",                 // xdbg debugger	
		L"ida.exe",                    // IDA disassembler
		L"ida64.exe",                  // IDA disassembler
		L"VsDebugConsole.exe",         // Visual Studio debugger	
		L"msvsmon.exe"                 // Visual Studio debugger
};

BOOL debugged()
{
	BOOL debugged = FALSE;

	PPEB ppeb = (PPEB)__readgsqword(0x60);
	if (ppeb->BeingDebugged == 1)
	{
		debugged = TRUE;
	}
	
	DWORD pid = NULL;
	HANDLE hprocess = NULL;
	for (int i = 0; i < BLACKLISTARRAY_SIZE; i++)
	{
		if (getpid(g_BlackListedDebuggers[i], &pid, &hprocess))
		{
			debugged = TRUE;
		}
	}

	return debugged;
}